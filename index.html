<!DOCTYPE html>
<html lang="pt-BR">
<head>
	<!--base href="https://duhzanetti.github.io/martingale_calc/"-->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#cddc39">
  <link rel="shortcut icon" href="img/faviocon.png
  " type="image/x-icon">
  <title>CALCULADORA DE MARTINGALE</title>

  <!-- Manifesto do PWA -->
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css"> <!-- Referência para o arquivo CSS -->
</head>
<body>
    <h2>Calculadora de Perca e Ganho - Martingale</h2>

    <label for="saldoInicial">Saldo Inicial:</label>
    <input type="number" id="saldoInicial" placeholder="Ex: 1000"><br>

    <label for="entradaInicial">Valor da Entrada Inicial:</label>
    <input type="number" id="entradaInicial" placeholder="Ex: 10"><br>

    <label for="fator">Fator Martingale:</label>
    <input type="number" id="fator" placeholder="Ex: 2"><br>

    <label for="payout">Payout (%):</label>
    <input type="number" id="payout" placeholder="Ex: 80"><br><br>

    <button onclick="calcular()">Calcular</button>

    <!-- Exibição do Martingale -->
    <div id="melhorTaxa">
		<span>Martingale:</span> <strong></strong><br>
		<span>Máximo de entradas possíveis:</span> <strong></strong><br>
		<span>Saldo necessário para próxima entrada:</span> <strong></strong><br>
		<span>Saldo total para próxima entrada:</span> <strong></strong>
	</div>

    <table id="resultado">
        <thead>
            <tr>
                <th>ENT</th>
                <th>VALOR</th>
                <th>ACUMULADO</th>
                <th>GANHO OP</th>
                <th>LÍQUIDO</th>
                <th>SALDO</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        function calcular() {
            const saldoInicial = parseFloat(document.getElementById("saldoInicial").value);
            const entradaInicial = parseFloat(document.getElementById("entradaInicial").value);
            const fator = parseFloat(document.getElementById("fator").value);
            const payout = parseFloat(document.getElementById("payout").value) / 100;

            // Verifica se todos os campos necessários estão preenchidos
            if (isNaN(saldoInicial) || isNaN(entradaInicial) || isNaN(fator) || isNaN(payout)) {
                alert("Por favor, preencha todos os campos obrigatórios.");
                return; // Sai da função se algum campo estiver vazio
            }

            let tbody = document.querySelector("#resultado tbody");
            tbody.innerHTML = ""; // Limpa a tabela

            let saldoAtual = saldoInicial;
            let valorEntrada = entradaInicial;
            let percaAcumulada = 0;
            let i = 1;
            let entradasPositivas = 0;
            let todasPositivas = true;

            // Variável para calcular saldo necessário para mais uma entrada
            let saldoNecessario = 0;

            // Calcula o Martingale e popula a tabela
            while (saldoAtual > 0) {
                let lucro = valorEntrada * payout;
                let balanco = lucro - percaAcumulada;
                percaAcumulada += valorEntrada;
                let saldoNegativo = saldoAtual - valorEntrada;

                // Verifica se o valor líquido ainda é positivo
                if (balanco > 0) {
                    entradasPositivas++;
                } else {
                    todasPositivas = false;
                }

                // Preencher a tabela
                let row = `<tr>
                    <td>${i}</td>
                    <td>${valorEntrada.toFixed(2)}</td>
                    <td>${percaAcumulada.toFixed(2)}</td>
                    <td>${lucro.toFixed(2)}</td>
                    <td>${balanco.toFixed(2)}</td>
                    <td>${saldoNegativo.toFixed(2)}</td>
                </tr>`;
                tbody.innerHTML += row;

                // Atualiza o saldo e entrada para a próxima rodada
                saldoAtual = saldoNegativo;
                valorEntrada *= fator;
                i++;

                // Se o saldo atual for menor que a próxima entrada, calcula o saldo necessário e encerra o loop
                if (saldoAtual <= valorEntrada) {
                    saldoNecessario = valorEntrada - saldoAtual;
                    break;
                }
            }

            // Exibe a quantidade de entradas com saldo líquido positivo ou "Positivo" com check
            if (todasPositivas) {
                document.querySelector("#melhorTaxa strong").innerHTML = `Positivo <span>✓</span>`;
            } else {
                document.querySelector("#melhorTaxa strong").innerHTML = `Entradas com saldo líquido positivo: <strong>${entradasPositivas}</strong>`;
            }

            // Calcula e exibe o máximo de entradas possíveis
            let maxEntradas = i - 1;
            document.querySelector("#melhorTaxa strong:nth-of-type(2)").innerHTML = `${maxEntradas}`;

            // Exibe o saldo necessário para realizar mais uma entrada
            if (saldoNecessario > 0) {
                document.querySelector("#melhorTaxa strong:nth-of-type(3)").innerHTML = `R$ ${saldoNecessario.toFixed(2)}`;
                
                // Cálculo do saldo total para a próxima entrada
                const saldoTotalParaProximaEntrada = saldoInicial + saldoNecessario; // Usando saldoInicial
                document.querySelector("#melhorTaxa strong:nth-of-type(4)").innerHTML = `R$ ${saldoTotalParaProximaEntrada.toFixed(2)}`;
            }
        }
    </script>

    <footer>
        <a href="https://github.com/duhzanetti/martingale_calc" target="_blank">
            <button>Projeto GitHub</button>
        </a>
    </footer>
</body>
</html>
